import { BasePipelineStage } from '../stage.js';
import type { ConfigManager } from '../../../config/index.js';
import type { GateLoader } from '../../../gates/core/gate-loader.js';
import type { Logger } from '../../../logging/index.js';
import type { ConvertedPrompt } from '../../../types/index.js';
import type { ExecutionContext } from '../../context/execution-context.js';
/**
 * Provider function to get all converted prompts.
 */
type PromptsProvider = () => ConvertedPrompt[];
/**
 * Provider for framework resources (derived from methodology definitions).
 */
type FrameworkResourceProvider = () => Promise<ConvertedPrompt[]> | ConvertedPrompt[];
/**
 * Pipeline Stage 6a: Judge Selection (Two-Phase Client-Driven Flow)
 *
 * This stage implements a two-phase resource selection system:
 *
 * ** - Judge Phase** (triggered by `%judge` / `%guided`):
 * - Collects all available resources (styles, frameworks, gates)
 * - Returns a judge prompt with resource menu for Claude to analyze
 * - Pipeline terminates early with the judge response
 *
 * ** - Execution Phase** (follow-up call with operators):
 * - Client reruns prompt_engine with inline operators (@framework, ::gates, #style)
 * - Pipeline continues with normal execution using operator-derived selections
 *
 * Dependencies: context.mcpRequest, context.executionPlan
 * Output:
 *   - Judge Phase: context.response (early return)
 *   - Execution Phase: operator-derived selections applied to framework state
 */
export declare class JudgeSelectionStage extends BasePipelineStage {
    private readonly promptsProvider;
    private readonly gateLoader;
    private readonly configManager;
    private readonly frameworksProvider?;
    readonly name = "JudgeSelection";
    constructor(promptsProvider: PromptsProvider | null, gateLoader: GateLoader | null, configManager: ConfigManager | null, logger: Logger, frameworksProvider?: (FrameworkResourceProvider | null) | undefined);
    execute(context: ExecutionContext): Promise<void>;
    /**
     * Apply inline style selector (#style) from the parsed command to framework state.
     */
    private applyInlineStyleSelection;
    /**
     * Determine if this request should trigger the judge phase.
     *
     * Judge phase is triggered when:
     * - `%judge` (or legacy `%guided`) modifier is used
     */
    private shouldTriggerJudgePhase;
    /**
     * Extract operator context from the parsed command.
     * Used to make the judge menu context-aware.
     */
    private getOperatorContext;
    /**
     * Get a cleaned version of the command for display (operators stripped).
     * Command format: >>prompt_id @FRAMEWORK :: gate or %modifier >>prompt_id
     */
    private getCleanCommandForDisplay;
    /**
     * Get methodology-specific judge prompt if a framework is active.
     */
    private getActiveMethodologyJudgePrompt;
    /**
     * Build the judge response with resource menu and selection instructions.
     * Context-aware: adapts based on operators already specified in the command.
     */
    private buildJudgeResponse;
    /**
     * Build a context header showing operators already specified in the command.
     */
    private buildOperatorContextHeader;
    /**
     * Collect all available resources from styles, frameworks, and gates.
     */
    private collectAllResources;
    /**
     * Detect framework-marked guidance prompt IDs (legacy; retained for style filtering).
     */
    private isFrameworkPromptId;
    /**
     * Build framework resources from methodology definitions to avoid duplicate Markdown prompts.
     */
    private collectFrameworkResources;
    /**
     * Convert methodology definition into a lightweight framework resource for the judge menu.
     */
    private mapMethodologyToFrameworkResource;
    /**
     * Load all available gate definitions.
     */
    private loadAllGates;
    /**
     * Format collected resources as a structured menu for Claude.
     * Context-aware: hides framework section if already specified, marks pre-selected gates.
     */
    private formatResourceMenuForClaude;
}
export {};
