#!/usr/bin/env sh

# Navigate to server directory
cd server || exit 1

echo "ğŸ” Running pre-push validation..."
echo ""

echo "1/5 Type checking..."
npm run typecheck || { echo "âŒ Type checking failed"; exit 1; }

echo ""
echo "2/5 Linting..."
npm run lint:ratchet || { echo "âŒ Lint ratchet failed (new violations introduced)"; exit 1; }

echo ""
echo "3/5 Format checking..."
echo "âœ… Skipped (format is enforced via eslint/prettier in lint-staged for staged files)"

echo ""
echo "4/5 Running tests..."
npm run test:ci || { echo "âŒ Tests failed"; exit 1; }

echo ""
echo "5/5 Dependency validation..."
npm run validate:arch || { echo "âŒ Dependency validation failed"; exit 1; }

echo ""
echo "âœ… All pre-push validation passed!"
echo ""
