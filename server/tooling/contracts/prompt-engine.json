{
  "tool": "prompt_engine",
  "version": 1,
  "summary": "Execute prompts/chains. Use >>prompt_id or /prompt_id. Modifiers go first: %judge @Framework #style :: gates. Use prompt_manager to discover valid IDs.",
  "toolDescription": {
    "description": "\ud83d\ude80 PROMPT ENGINE [CAGEERF]: Expands prompts with C.A.G.E.E.R.F methodology for you to follow.\n\nWHAT IT RETURNS: Prepared prompt + CAGEERF phase instructions (Context\u2192Analysis\u2192Goals\u2192Execution\u2192Evaluation\u2192Refinement).\nWHAT YOU DO: Execute each phase yourself using the returned structure.\n\nSYNTAX: >>prompt_id key=\"value\" | Chain: >>s1 --> >>s2\nOPERATORS: @CAGEERF | :: \"criteria\" | %clean/%lean\n",
    "shortDescription": "Expand and return prompt templates",
    "category": "execution",
    "triggerExamples": [
      "User: '>>analyze this code' \u2192 prompt_engine(command: '>>analyze this code')"
    ],
    "frameworkAware": {
      "enabled": "\ud83d\ude80 PROMPT ENGINE [FRAMEWORK]: Returns prompts with methodology guidance injected. You apply the methodology yourself.",
      "disabled": "\ud83d\ude80 PROMPT ENGINE: Returns prompts without methodology injection. Raw template expansion only."
    }
  },
  "parameters": [
    {
      "name": "command",
      "type": "string",
      "description": "Prompt ID to expand. Format: >>prompt_id key=\"value\" | Chains: >>s1 --> >>s2 | Modifiers first: @Framework :: \"criteria\" %clean/%lean",
      "required": false,
      "status": "working",
      "notes": [
        "Every step needs prompt ID prefix (>> or /). Modifiers apply to whole chain.",
        "Script tools: tool:<id> to invoke; confirm:true tools need approval."
      ],
      "examples": [
        "@CAGEERF #analytical >>analyze topic:'metrics' --> >>report :: 'cite sources'"
      ]
    },
    {
      "name": "chain_id",
      "type": "string",
      "description": "Resume token (chain-{prompt} or chain-{prompt}#runNumber). RESUME: chain_id + user_response only. Omit command.",
      "status": "working"
    },
    {
      "name": "user_response",
      "type": "string",
      "description": "Your completed output from executing the previous step. Paste your work here when resuming a chain. Use with chain_id; do not include command when resuming.",
      "status": "working"
    },
    {
      "name": "gate_verdict",
      "type": "string",
      "description": "Gate review verdict with flexible format support. Primary: 'GATE_REVIEW: PASS|FAIL - reason'. Also accepts: 'GATE PASS - reason', 'GATE_REVIEW: FAIL: reason', 'PASS - reason' (minimal).",
      "status": "working"
    },
    {
      "name": "gate_action",
      "type": "enum",
      "enum": ["retry", "skip", "abort"],
      "description": "User choice after gate retry limit exhaustion. 'retry' resets attempt count for another try, 'skip' bypasses the failed gate and continues, 'abort' stops chain execution entirely.",
      "status": "working"
    },
    {
      "name": "gates",
      "type": "array<string|{name,description}|gate>",
      "description": "Quality gates for output validation. Three formats supported:\n\n**1. Registered IDs** (strings): Use predefined gates like 'code-quality', 'research-quality'.\n\n**2. Quick Gates** (RECOMMENDED for LLM-generated validation): `{name, description}` - Create named, domain-specific checks on the fly. Example: `{name: 'Source Quality', description: 'All sources must be official docs'}`.\n\n**3. Full Definitions**: Complete schema with severity, criteria[], pass_criteria[], guidance for production workflows.",
      "status": "working",
      "compatibility": "canonical",
      "notes": [
        "RECOMMENDED: Quick Gates {name, description} auto-default to severity:medium, type:validation.",
        "Full schema: id, name, severity, criteria[], pass_criteria[], guidance, apply_to_steps[]."
      ],
      "examples": [
        "[{\"name\": \"Source Quality\", \"description\": \"All sources must be official docs\"}]"
      ]
    },
    {
      "name": "force_restart",
      "type": "boolean",
      "description": "Restart chain from step 1, ignoring cached state.",
      "status": "working"
    },
    {
      "name": "options",
      "type": "record",
      "description": "Execution options forwarded downstream.",
      "status": "working"
    }
  ],
  "commands": [
    {
      "id": "chain-resume",
      "summary": "Resume chain via chain_id + user_response/gate_verdict/gate_action",
      "parameters": ["chain_id", "user_response", "gate_verdict", "gate_action"]
    }
  ]
}
